# {{ project_name }}

## Before You Act

**IMPORTANT:** Before executing any task, you must:

1. **Read `sop.md`** - Understand the full process and requirements
2. **Read all files in `/functions`** - Understand what implementations already exist, their signatures, docstrings, and SOP references
3. **Look up relevant skills in `/skills`** - Read the SKILL.md for any skills that may apply to your task

Only after reviewing existing code should you plan your approach and begin execution.

## Layout

```
{{ project_slug }}/
├── sop.md          # Source SOP (markdown)
├── manifest.json   # Function specifications
├── env.md          # External services docs
├── UNFURL.md       # Code generation instructions
├── ENTRY.md        # This file
│
├── input/          # Input files for processing
├── output/         # Generated output files
│
├── skills/         # Specialized capabilities (see Skills section)
├── models/         # Pydantic data models
├── functions/      # Function implementations
└── tests/          # Pytest tests
```

## File I/O

- **input/**: Place files here that functions need to process (e.g., documents, data files)
- **output/**: Functions write their generated results here (e.g., reports, processed data)

## Skills

The `skills/` directory contains specialized capabilities with documentation and utilities.

### Available Skills

| Skill | Purpose |
|-------|---------|
| `pdf` | PDF manipulation - extract, create, merge, forms |
| `xlsx` | Spreadsheet creation, editing, formula recalculation |
| `docx` | Document creation, editing, tracked changes |
| `internal-comms` | Internal communications templates |
| `claude` | LLM for text generation, JSON extraction, image analysis |
| `phonic` | AI telephone agent for outbound calls, transcripts |
| `browser-use` | AI browser agent for web scraping, automation, research |
| `mapbox` | Geocoding, directions, distance matrices, route optimization |

Each skill has a `SKILL.md` with frontmatter (`name`, `description`, `license`), usage guides, and supporting files.

### Usage Patterns

**Library Pattern** - Run skill utilities directly:
```bash
uv run skills/xlsx/recalc.py output.xlsx
```

**Snippet Pattern** - Copy and adapt code from skill documentation:
- Read the SKILL.md for the relevant skill
- Find code examples matching your use case
- Adapt the pattern to your specific requirements

**Agentic Pattern** - Runtime skill invocation for complex tasks:
1. Read the skill's SKILL.md to understand capabilities
2. Follow the skill's workflow instructions
3. Use extended thinking (ultrathink) to plan thoroughly before implementation

## Python Environment

Use `uv` for all Python operations:

- Run scripts: `uv run script.py`
- Run with dependencies: `uv run --with package script.py`
- Run tests: `uv run pytest`
- Install dependencies: `uv sync`

## Function Pattern

```python
def function_name(data: InputModel) -> OutputModel:
    """
    Description.

    SOP Reference:
    > Cited text from sop.md
    """
    ...
```

## Naming

- Models: `PascalCase` (e.g., `Invoice`, `ValidationResult`)
- Functions: `snake_case` (e.g., `validate_invoice`)
- Fields: `snake_case` (e.g., `vendor_name`)
- Tests: `test_{function_name}.py`

## Agent Execution Guidelines

### Implementation Priority
When implementing functionality, prefer reusing existing code over writing new code:

1. **functions/** - Check for pre-written functions first. These are tested, project-specific implementations.
2. **skills/** - If no suitable function exists, use skill utilities and patterns from SKILL.md documentation.
3. **Custom implementation** - Only write new code when existing functions and skills don't meet the requirement.

This hierarchy ensures consistency, reduces errors, and leverages tested code.

### Output Handling
When users request deliverables (files, reports, data exports), **always place them in the `output/` folder**. This is the designated location for all user-requested outputs and results.

### Error Recovery & State Awareness
When fixing execution errors in scripts, be mindful of code that has already run:

- **Never re-run side-effect operations** that completed successfully:
  - API calls that cause mutations
  - Database writes
  - Phone/SMS calls (phonic)
  - External service interactions
- **Print intermediate results** to stdout as a memory system for tracking previous step outputs
- **Use execution methods that capture stdout** for debugging and state recovery

### Script Correctness
Scripts must be correct - take extra care during generation:

- **Spend additional thinking time** on complex logic before writing code
- **For tricky calls**, consider writing a test first to validate logic:
  - Tests MUST mock all side effects (no real API calls, DB writes, phone calls)
  - Use judgment on when tests are worth the time investment
- **Validate assumptions** before making external calls

### Script Decomposition
Carefully consider single script vs. multiple scripts:

- **Multiple scripts are preferred** when:
  - Tasks have natural checkpoints
  - Errors at any step need different handling
  - Recovery from failures is important
- **Benefits of decomposition**:
  - Easier to react to errors at each step
  - Better recovery from unforeseen situations
  - Clear audit trail of what succeeded/failed

### SOP Completion
Execute all applicable SOP steps to completion:

- Do not skip steps unless explicitly instructed
- Handle each step thoroughly before proceeding
- Report progress and any issues encountered